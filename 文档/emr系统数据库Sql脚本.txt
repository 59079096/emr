--------创建emrDB数据库
Create Database emrDB
On primary
(
name=emrDB,
filename='C:\emrdb\emrDB.mdf',
size=3,
maxsize=unlimited,
filegrowth=1
)
Log On
(
name=mvsDB_log,
filename='C:\emrdb\emrDB_log.ldf',
size=1,
maxsize=unlimited,
filegrowth=10%
)


--------创建emrDB数据库和用户
--创建登录名和用词
Create Login emr With Password = 'admin20170613.';
--用词关联数据库
Use emrDB
Create User emr
For Login emr
With DEFAULT_SCHEMA = dbo
--访问数据库
Use emrDB
EXEC sp_addrolemember 'db_owner', 'emr'
--赋值权限，如果需要
grant select,insert,delete,update,references,alter,exec on database::emrDB
to emr
with grant option

============================框架工作所需表==========================
--------业务处理时涉及到的数据库连接
create table frame_blldbconn
(  
id int PRIMARY KEY IDENTITY(1,1),   
dbtype int not null,
conname nvarchar(20) not null,
server nvarchar(20) not null,
port int,
dbname nvarchar(20) not null,
username nvarchar(20) not null,
paw nvarchar(20) not null
)
EXECUTE sp_addextendedproperty N'MS_Description', '业务处理时涉及到的数据库连接', N'user', N'dbo', N'table', N'frame_bllDBconn', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID(自增)', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据库类型(为配合代码的枚举从0开始) 0:sqlserver, 1:oracle, 2:DB2, 3:sqlite, 4:mysql', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'dbtype' 
EXECUTE sp_addextendedproperty N'MS_Description', '连接名称', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'conname' 
EXECUTE sp_addextendedproperty N'MS_Description', '服务器地址', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'server'
EXECUTE sp_addextendedproperty N'MS_Description', '数据库端口', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'port' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据库名', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'dbname'
EXECUTE sp_addextendedproperty N'MS_Description', '账号', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'username'
EXECUTE sp_addextendedproperty N'MS_Description', '密码', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'paw'


--------业务数据sql脚本表(frame_bllsql)
create table frame_bllsql
(  
id int PRIMARY KEY IDENTITY(1,1), 
bllid int not null,  
name nvarchar(50) not null,
dbconnid int not null default 0, 
sqltext nvarchar(2000) not null, 
script nvarchar(4000),
scriptbin image, 
ver nvarchar(10) not null default 0
)
EXECUTE sp_addextendedproperty N'MS_Description', '业务数据sql脚本表', N'user', N'dbo', N'table', N'frame_bllsql', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID(自增)', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '业务唯一标识ID,用户自定义的从1000开始', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'bllid' 
EXECUTE sp_addextendedproperty N'MS_Description', '业务名称', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '业务连接的数据库信息，0表示当前库否则关联表frame_blldbconn', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'dbconnid'
EXECUTE sp_addextendedproperty N'MS_Description', '执行业务对应的sql脚本', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'sqltext'
EXECUTE sp_addextendedproperty N'MS_Description', '业务script脚本', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'script' 
EXECUTE sp_addextendedproperty N'MS_Description', '业务script脚本编译后的二进制数据', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'scriptbin'
EXECUTE sp_addextendedproperty N'MS_Description', '业务对应的客户端版本(不同版本客户端调用时区分不同版本业务)', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'ver'
--------添加框架语句
INSERT INTO frame_bllsql (bllid, name, sqltext, ver) VALUES (1, '获取服务器当前时间', 'SELECT GETDATE() AS dt', '1.0');


============================自定义业务表==========================
--------系统参数及配置表(Comm_Params)
create table Comm_Params  
(  
id int PRIMARY KEY IDENTITY(1,1),
Name nvarchar(20) not null,
Value nvarchar(20),
Explain nvarchar(50),
)
EXECUTE sp_addextendedproperty N'MS_Description', '系统参数及配置表', N'user', N'dbo', N'table', N'Comm_Params', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '唯一标识(自增)', N'user', N'dbo', N'table', N'Comm_Params', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '参数名', N'user', N'dbo', N'table', N'Comm_Params', N'column', N'Name'
EXECUTE sp_addextendedproperty N'MS_Description', '参数值', N'user', N'dbo', N'table', N'Comm_Params', N'column', N'Value' 
EXECUTE sp_addextendedproperty N'MS_Description', '参数说明', N'user', N'dbo', N'table', N'Comm_Params', N'column', N'Explain' 
--------添加默认参数
INSERT INTO Comm_Params (name, value, explain) VALUES ('Hospital', '未设置当前医院', '用于系统显示的医院名称');


--------用户信息表(Comm_User)
create table Comm_User  
(  
id int PRIMARY KEY IDENTITY(1,1),
UserID nvarchar(10) not null,
UserName nvarchar(10) not null,
PY nvarchar(10),
SexID tinyint,
Birthday date,
DeptID int not null,
CreateDate date not null,
PAW nvarchar(32) not null,
State bit not null default 1
)
EXECUTE sp_addextendedproperty N'MS_Description', '用户信息表', N'user', N'dbo', N'table', N'Comm_User', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '标识-用户唯一标识', N'user', N'dbo', N'table', N'Comm_User', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '账号-用户账号', N'user', N'dbo', N'table', N'Comm_User', N'column', N'UserID' 
EXECUTE sp_addextendedproperty N'MS_Description', '姓名-用户姓名', N'user', N'dbo', N'table', N'Comm_User', N'column', N'UserName' 
EXECUTE sp_addextendedproperty N'MS_Description', '拼音简码-用户拼音简码', N'user', N'dbo', N'table', N'Comm_User', N'column', N'PY'
EXECUTE sp_addextendedproperty N'MS_Description', '性别-性别编码，关联表His_Dic_Sex', N'user', N'dbo', N'table', N'Comm_User', N'column', N'SexID' 
EXECUTE sp_addextendedproperty N'MS_Description', '生日-用户出生日期', N'user', N'dbo', N'table', N'Comm_User', N'column', N'Birthday' 
EXECUTE sp_addextendedproperty N'MS_Description', '科室-科室ID，关联表Comm_Dept', N'user', N'dbo', N'table', N'Comm_User', N'column', N'DeptID'
EXECUTE sp_addextendedproperty N'MS_Description', '创建日期-新建用户日期', N'user', N'dbo', N'table', N'Comm_User', N'column', N'CreateDate' 
EXECUTE sp_addextendedproperty N'MS_Description', '密码-用户密码', N'user', N'dbo', N'table', N'Comm_User', N'column', N'PAW'
EXECUTE sp_addextendedproperty N'MS_Description', '用户状态0停用1启用，默认为1', N'user', N'dbo', N'table', N'Comm_User', N'column', N'State'


--------科室信息表(Comm_Dept)
create table Comm_Dept  
(  
id int PRIMARY KEY IDENTITY(1,1),   
Name nvarchar(20) not null,
PY nvarchar(20),   
ClinicattrID int,
OutpattrID int,
CreateDate date, 
State bit not null default 1 
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '科室信息表', N'user', N'dbo', N'table', N'Comm_Dept', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dept', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称-科室名称', N'user', N'dbo', N'table', N'Comm_Dept', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '拼音简码-科室拼音简码', N'user', N'dbo', N'table', N'Comm_Dept', N'column', N'PY'
EXECUTE sp_addextendedproperty N'MS_Description', '临床科室属性-关联表His_Dic_Clinicattr如临床科室、护理单元等', N'user', N'dbo', N'table', N'Comm_Dept', N'column', N'ClinicattrID'
EXECUTE sp_addextendedproperty N'MS_Description', '门诊住院科室属性-关联表His_Dic_Outpattr', N'user', N'dbo', N'table', N'Comm_Dept', N'column', N'OutpattrID'
EXECUTE sp_addextendedproperty N'MS_Description', '创建日期-科室创建日期', N'user', N'dbo', N'table', N'Comm_Dept', N'column', N'CreateDate'
EXECUTE sp_addextendedproperty N'MS_Description', '使用状态-(0停用 1使用)，默认为1', N'user', N'dbo', N'table', N'Comm_Dept', N'column', N'State'


--------性别字典表(Comm_Dic_Sex)
create table Comm_Dic_Sex  
(  
id int PRIMARY KEY IDENTITY(1,1),   
Name nvarchar(20) not null,
Code nvarchar(20) not null,   
State bit not null default 1 
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '性别字典表', N'user', N'dbo', N'table', N'Comm_Dic_Sex', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_Sex', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称-性别名称', N'user', N'dbo', N'table', N'Comm_Dic_Sex', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '性别编码', N'user', N'dbo', N'table', N'Comm_Dic_Sex', N'column', N'Code'
EXECUTE sp_addextendedproperty N'MS_Description', '使用状态-(0停用 1使用)，默认为1', N'user', N'dbo', N'table', N'Comm_Dic_Sex', N'column', N'State'


--------护理级别字典表(Comm_Dic_NursingLevel)
create table Comm_Dic_NursingLevel  
(  
id int PRIMARY KEY IDENTITY(1,1),   
Name nvarchar(20) not null,   
State bit not null default 1 
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '性别字典表', N'user', N'dbo', N'table', N'Comm_Dic_NursingLevel', NULL, NULL
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_NursingLevel', N'column', N'id'
EXECUTE sp_addextendedproperty N'MS_Description', '名称-护理级别名称', N'user', N'dbo', N'table', N'Comm_Dic_NursingLevel', N'column', N'Name'
EXECUTE sp_addextendedproperty N'MS_Description', '使用状态-(0停用 1使用)，默认为1', N'user', N'dbo', N'table', N'Comm_Dic_NursingLevel', N'column', N'State'


--------病情状态字典表(Comm_Dic_Patcond)
create table Comm_Dic_Patcond  
(  
id int PRIMARY KEY IDENTITY(1,1),   
Name nvarchar(20) not null,
Code nvarchar(20) not null,   
State bit not null default 1 
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '性别字典表', N'user', N'dbo', N'table', N'Comm_Dic_Patcond', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_Patcond', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '病情状态名称', N'user', N'dbo', N'table', N'Comm_Dic_Patcond', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '病情状态编码', N'user', N'dbo', N'table', N'Comm_Dic_Patcond', N'column', N'Code'
EXECUTE sp_addextendedproperty N'MS_Description', '使用状态-(0停用 1使用)，默认为1', N'user', N'dbo', N'table', N'Comm_Dic_Patcond', N'column', N'State'


--------工作组(Comm_Group)
create table Comm_Group  
(  
id int PRIMARY KEY IDENTITY(1,1),   
Name nvarchar(10) not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '工作组', N'user', N'dbo', N'table', N'Comm_Group', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Group', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称', N'user', N'dbo', N'table', N'Comm_Group', N'column', N'Name'


--------工作组对应的科室(Comm_Auth_Group)
create table Comm_Auth_Group  
(  
id int PRIMARY KEY IDENTITY(1,1),   
GroupID int not null,
DeptID int not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '工作组对应的科室', N'user', N'dbo', N'table', N'Comm_Auth_Group', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Auth_Group', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '工作组ID', N'user', N'dbo', N'table', N'Comm_Auth_Group', N'column', N'GroupID'
EXECUTE sp_addextendedproperty N'MS_Description', '科室ID', N'user', N'dbo', N'table', N'Comm_Auth_Group', N'column', N'DeptID'


--------角色(Comm_Role)
create table Comm_Role  
(  
id int PRIMARY KEY IDENTITY(1,1),   
Name nvarchar(10) not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '角色', N'user', N'dbo', N'table', N'Comm_Role', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Role', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称', N'user', N'dbo', N'table', N'Comm_Role', N'column', N'Name'


--------角色功能对应关系(Comm_Auth_Role)
create table Comm_Auth_Role  
(  
id int PRIMARY KEY IDENTITY(1,1),
RoleID int not null,
FunID int not null,
RangeID int not null,
RangeDept nvarchar(50)
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '角色功能对应关系', N'user', N'dbo', N'table', N'Comm_Auth_Role', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Auth_Role', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '角色ID', N'user', N'dbo', N'table', N'Comm_Auth_Role', N'column', N'RoleID'
EXECUTE sp_addextendedproperty N'MS_Description', '功能ID', N'user', N'dbo', N'table', N'Comm_Auth_Role', N'column', N'FunID'
EXECUTE sp_addextendedproperty N'MS_Description', '功能范围ID', N'user', N'dbo', N'table', N'Comm_Auth_Role', N'column', N'RangeID'
EXECUTE sp_addextendedproperty N'MS_Description', '功能范围是多科室时指定的科室（用英文逗号分隔)', N'user', N'dbo', N'table', N'Comm_Auth_Role', N'column', N'RangeDept'


--------功能模块(Comm_Dic_FunctionModule)
create table Comm_Dic_FunctionModule
(  
id int PRIMARY KEY IDENTITY(1,1),
Name nvarchar(10) not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '功能模块字典表', N'user', N'dbo', N'table', N'Comm_Dic_FunctionModule', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_FunctionModule', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称', N'user', N'dbo', N'table', N'Comm_Dic_FunctionModule', N'column', N'Name'


--------功能(Comm_Dic_Function)
create table Comm_Dic_Function  
(  
id int PRIMARY KEY IDENTITY(1,1),
Name nvarchar(10) not null,
ModuleID int not null,
ParentID int not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '功能', N'user', N'dbo', N'table', N'Comm_Dic_Function', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_Function', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称', N'user', N'dbo', N'table', N'Comm_Dic_Function', N'column', N'Name'
EXECUTE sp_addextendedproperty N'MS_Description', '所属模块ID，关联表Comm_Dic_FunctionModule', N'user', N'dbo', N'table', N'Comm_Dic_Function', N'column', N'ModuleID'
EXECUTE sp_addextendedproperty N'MS_Description', '父节点ID', N'user', N'dbo', N'table', N'Comm_Dic_Function', N'column', N'ParentID'


--------功能范围(Comm_Dic_FunctionRange)
create table Comm_Dic_FunctionRange  
(  
id int PRIMARY KEY IDENTITY(1,1),
Name nvarchar(10) not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '功能范围', N'user', N'dbo', N'table', N'Comm_Dic_FunctionRange', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_FunctionRange', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称', N'user', N'dbo', N'table', N'Comm_Dic_FunctionRange', N'column', N'Name'


--------界面控件和功能对应关系表(Comm_Auth_UI)
create table Comm_Auth_UI  
(  
id int PRIMARY KEY IDENTITY(1,1),
FormName nvarchar(20) not null,
ControlName nvarchar(50) not null,
VisibleType int not null,
FunID int not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '界面控件和功能对应关系表', N'user', N'dbo', N'table', N'Comm_Auth_UI', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Auth_UI', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '窗体名', N'user', N'dbo', N'table', N'Comm_Auth_UI', N'column', N'FormName'
EXECUTE sp_addextendedproperty N'MS_Description', '控件名', N'user', N'dbo', N'table', N'Comm_Auth_UI', N'column', N'ControlName'
EXECUTE sp_addextendedproperty N'MS_Description', '无权限时显示方式0不显示，1不可用', N'user', N'dbo', N'table', N'Comm_Auth_UI', N'column', N'VisibleType' 
EXECUTE sp_addextendedproperty N'MS_Description', '控件对应的功能ID', N'user', N'dbo', N'table', N'Comm_Auth_UI', N'column', N'FunID'


--------用户角色(Comm_User_Role)
create table Comm_User_Role  
(  
id int PRIMARY KEY IDENTITY(1,1),
UserID nvarchar(10) not null,
RoleID int not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '用户角色', N'user', N'dbo', N'table', N'Comm_User_Role', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_User_Role', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '用户ID', N'user', N'dbo', N'table', N'Comm_User_Role', N'column', N'UserID'
EXECUTE sp_addextendedproperty N'MS_Description', '角色ID', N'user', N'dbo', N'table', N'Comm_User_Role', N'column', N'RoleID'


--------用户对应的工作组(Comm_User_Group)
create table Comm_User_Group  
(  
id int PRIMARY KEY IDENTITY(1,1),
UserID nvarchar(10) not null,
GroupID int not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '用户对应的工作组', N'user', N'dbo', N'table', N'Comm_User_Group', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_User_Group', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '用户ID', N'user', N'dbo', N'table', N'Comm_User_Group', N'column', N'UserID'
EXECUTE sp_addextendedproperty N'MS_Description', '工作组ID', N'user', N'dbo', N'table', N'Comm_User_Group', N'column', N'GroupID'


--------升级信息表(UpdateInfo)--------已经不用
create table UpdateInfo  
(  
id int PRIMARY KEY IDENTITY(1,1),
Version nvarchar(32) not null,
Files nvarchar(1000) not null,
Explain nvarchar(32) not null,
Enforce bit not null default 1
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '升级文件', N'user', N'dbo', N'table', N'UpdateInfo', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '版本号', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Version'
EXECUTE sp_addextendedproperty N'MS_Description', '文件', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Files'
EXECUTE sp_addextendedproperty N'MS_Description', '说明', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Explain'
EXECUTE sp_addextendedproperty N'MS_Description', '是否强制升级，1强制，0不强制', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Enforce' 


--------需要客户端缓存到本地的数据表(ClientCache)
create table ClientCache  
(  
id int PRIMARY KEY IDENTITY(1,1),
tbName nvarchar(32) not null,
tbField nvarchar(32) not null,
DataVer int not null,
Used bit not null default 1
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '需要客户端缓存到本地的数据表', N'user', N'dbo', N'table', N'ClientCache', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'ClientCache', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '表名', N'user', N'dbo', N'table', N'ClientCache', N'column', N'tbName'
EXECUTE sp_addextendedproperty N'MS_Description', '字段', N'user', N'dbo', N'table', N'ClientCache', N'column', N'tbField'
EXECUTE sp_addextendedproperty N'MS_Description', '数据版本号', N'user', N'dbo', N'table', N'ClientCache', N'column', N'DataVer'
EXECUTE sp_addextendedproperty N'MS_Description', '是否在用，1在用，0废弃', N'user', N'dbo', N'table', N'ClientCache', N'column', N'Used'


--------数据集目录表(Comm_DataElementSet)
create table Comm_DataElementSet
(  
id int PRIMARY KEY IDENTITY(1,1), 
pid int not null,  
Name nvarchar(20) not null,
Class int not null,
Type int not null,
UseRang smallint not null default 0,
InOrOut smallint not null default 0,
od smallint,
creator nvarchar(10)
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据集目录表', N'user', N'dbo', N'table', N'Comm_DataElementSet', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID(自增)', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '父节点ID', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'pid' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据集名称', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据集类别 1正文 2页眉 3页脚', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'Class' 
EXECUTE sp_addextendedproperty N'MS_Description', '类型 1数据集 2数据组', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'Type'
EXECUTE sp_addextendedproperty N'MS_Description', '使用范围 1临床 2护理 3临床及护理', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'UseRang'
EXECUTE sp_addextendedproperty N'MS_Description', '住院or门诊 1住院 2门诊 3住院及门诊', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'InOrOut'
EXECUTE sp_addextendedproperty N'MS_Description', '病历排序号', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'od'
EXECUTE sp_addextendedproperty N'MS_Description', '目录创建者ID', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'creator'


--------模板信息表(Comm_TemplateInfo)
create table Comm_TemplateInfo
(  
id int PRIMARY KEY IDENTITY(1,1), 
tname nvarchar(20) not null,
desid int not null,
owner int not null,
ownerid nvarchar(50)
)
EXECUTE sp_addextendedproperty N'MS_Description', '模板信息表', N'user', N'dbo', N'table', N'Comm_TemplateInfo', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '模板ID', N'user', N'dbo', N'table', N'Comm_TemplateInfo', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '模板名称', N'user', N'dbo', N'table', N'Comm_TemplateInfo', N'column', N'tname' 
EXECUTE sp_addextendedproperty N'MS_Description', '所属数据集ID', N'user', N'dbo', N'table', N'Comm_TemplateInfo', N'column', N'desid' 
EXECUTE sp_addextendedproperty N'MS_Description', '拥有者 1全院 2科室 3个人', N'user', N'dbo', N'table', N'Comm_TemplateInfo', N'column', N'owner' 
EXECUTE sp_addextendedproperty N'MS_Description', '拥有者ID 当owner为1时为空，owner为2时为所属科室ID，owner为3时为所有者用户名', N'user', N'dbo', N'table', N'Comm_TemplateInfo', N'column', N'ownerid'  


--------模板内容表(Comm_TemplateContent)
create table Comm_TemplateContent
(  
tid int PRIMARY KEY, 
content image
)
EXECUTE sp_addextendedproperty N'MS_Description', '模板内容表', N'user', N'dbo', N'table', N'Comm_TemplateContent', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '模板ID', N'user', N'dbo', N'table', N'Comm_TemplateContent', N'column', N'tid' 
EXECUTE sp_addextendedproperty N'MS_Description', '模板内容', N'user', N'dbo', N'table', N'Comm_TemplateContent', N'column', N'content' 


--------数据元值域字典表(Comm_Dic_Domain)
create table Comm_Dic_Domain
(  
DID int PRIMARY KEY IDENTITY(1,1),
DCode nvarchar(20) not null,
DName nvarchar(80)
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据元值域字典表', N'user', N'dbo', N'table', N'Comm_Dic_Domain', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'DID', N'user', N'dbo', N'table', N'Comm_Dic_Domain', N'column', N'DID' 
EXECUTE sp_addextendedproperty N'MS_Description', '值域编码', N'user', N'dbo', N'table', N'Comm_Dic_Domain', N'column', N'DCode' 
EXECUTE sp_addextendedproperty N'MS_Description', '值域名称', N'user', N'dbo', N'table', N'Comm_Dic_Domain', N'column', N'DName' 


--------数据元表(Comm_DataElement)
create table Comm_DataElement
(  
DeID int PRIMARY KEY IDENTITY(1,1),
DeCode nvarchar(16) not null,
DeName nvarchar(30) not null,
PY nvarchar(10) not null default '',
dedefine nvarchar(120) not null,
detype nvarchar(2) not null,
deformat nvarchar(10) not null default '',
frmtp nvarchar(2) not null,
deunit nvarchar(20) not null default '',
domainid int not null default 0
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据元表', N'user', N'dbo', N'table', N'Comm_DataElement', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '数据元ID', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'DeID' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据元编码', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'DeCode' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据元名称', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'DeName' 
EXECUTE sp_addextendedproperty N'MS_Description', '拼音码', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'PY'  
EXECUTE sp_addextendedproperty N'MS_Description', '定义', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'dedefine' 
EXECUTE sp_addextendedproperty N'MS_Description', '类型', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'detype' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据格式', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'deformat' 
EXECUTE sp_addextendedproperty N'MS_Description', '类别', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'frmtp' 
EXECUTE sp_addextendedproperty N'MS_Description', '单位', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'deunit' 
EXECUTE sp_addextendedproperty N'MS_Description', '值域ID', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'domainid'

--------常用数据元列表(Comm_DataElementCommon)
create table Comm_DataElementCommon
(  
CommID int PRIMARY KEY IDENTITY(1,1),
deid int not null
)
EXECUTE sp_addextendedproperty N'MS_Description', '常用数据元列表', N'user', N'dbo', N'table', N'Comm_DataElementCommon', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '唯一ID', N'user', N'dbo', N'table', N'Comm_DataElementCommon', N'column', N'CommID' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据元ID，Comm_DataElement表ID', N'user', N'dbo', N'table', N'Comm_DataElementCommon', N'column', N'deid'

--------数据元值引用表(Comm_DataElementSetMacro)
create table Comm_DataElementSetMacro
(  
ID int PRIMARY KEY IDENTITY(1,1),  
DesID int not null,
ObjID int not null,
MacroType int not null default 0,
Macro nvarchar(200) not null default ''
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据元值引用表', N'user', N'dbo', N'table', N'Comm_DataElementSetMacro', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '自增ID', N'user', N'dbo', N'table', N'Comm_DataElementSetMacro', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据集ID', N'user', N'dbo', N'table', N'Comm_DataElementSetMacro', N'column', N'DesID' 
EXECUTE sp_addextendedproperty N'MS_Description', '对象ID', N'user', N'dbo', N'table', N'Comm_DataElementSetMacro', N'column', N'ObjID' 
EXECUTE sp_addextendedproperty N'MS_Description', '引用类型 1:患者信息(客户端) 2:用户信息(客户端) 3:病历信息(服务端) 4:环境信息(服务端，如当前时间等) 5:SQL脚本(服务端)', N'user', N'dbo', N'table', N'Comm_DataElementSetMacro', N'column', N'MacroType' 
EXECUTE sp_addextendedproperty N'MS_Description', '引用内容', N'user', N'dbo', N'table', N'Comm_DataElementSetMacro', N'column', N'Macro'


--------数据元值域表(Comm_DataElementDomain)
create table Comm_DataElementDomain
(  
ID int PRIMARY KEY IDENTITY(1,1),  
domainid int not null,
Code nvarchar(20) not null,
devalue nvarchar(50) not null,
PY nvarchar(10)
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据元值域表', N'user', N'dbo', N'table', N'Comm_DataElementDomain', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID', N'user', N'dbo', N'table', N'Comm_DataElementDomain', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '值域编码', N'user', N'dbo', N'table', N'Comm_DataElementDomain', N'column', N'domainid' 
EXECUTE sp_addextendedproperty N'MS_Description', '值编码', N'user', N'dbo', N'table', N'Comm_DataElementDomain', N'column', N'Code' 
EXECUTE sp_addextendedproperty N'MS_Description', '值名称', N'user', N'dbo', N'table', N'Comm_DataElementDomain', N'column', N'devalue' 
EXECUTE sp_addextendedproperty N'MS_Description', '值拼音码', N'user', N'dbo', N'table', N'Comm_DataElementDomain', N'column', N'py' 


--------数据元值域选项关联的内容表(Comm_DomainContent)
create table Comm_DomainContent
(  
DCID int PRIMARY KEY IDENTITY(1,1),
DItemID int not null, 
Content image
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据元值域选项关联的内容表', N'user', N'dbo', N'table', N'Comm_DomainContent', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '内容ID', N'user', N'dbo', N'table', N'Comm_DomainContent', N'column', N'DCID' 
EXECUTE sp_addextendedproperty N'MS_Description', '选项ID', N'user', N'dbo', N'table', N'Comm_DomainContent', N'column', N'DItemID' 
EXECUTE sp_addextendedproperty N'MS_Description', '选项内容', N'user', N'dbo', N'table', N'Comm_DomainContent', N'column', N'content' 


--------数据元控制脚本表(Comm_DataElementScript)
create table Comm_DataElementScript
(  
ID int PRIMARY KEY IDENTITY(1,1),
DEID int not null, 
Script nvarchar(1024)
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据元控制脚本表', N'user', N'dbo', N'table', N'Comm_DataElementScript', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID', N'user', N'dbo', N'table', N'Comm_DataElementScript', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', 'DEID数据元ID', N'user', N'dbo', N'table', N'Comm_DataElementScript', N'column', N'DEID' 
EXECUTE sp_addextendedproperty N'MS_Description', '脚本内容', N'user', N'dbo', N'table', N'Comm_DataElementScript', N'column', N'Script' 


--------数据集包含的数据元表(Comm_DataSetElement)
create table Comm_DataSetElement
(  
ID int PRIMARY KEY IDENTITY(1,1),
DsID int not null, 
DeID int not null,
KX bit not null default 0
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据集包含的数据元表', N'user', N'dbo', N'table', N'Comm_DataSetElement', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID', N'user', N'dbo', N'table', N'Comm_DataSetElement', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据集ID，对应Comm_DataElementSet中的id', N'user', N'dbo', N'table', N'Comm_DataSetElement', N'column', N'DsID' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据元ID', N'user', N'dbo', N'table', N'Comm_DataSetElement', N'column', N'DeID' 
EXECUTE sp_addextendedproperty N'MS_Description', '不可缺失，必有项 1是 0否', N'user', N'dbo', N'table', N'Comm_DataSetElement', N'column', N'KX' 


--------ICD10字典表(Comm_Dic_ICD10)
create table Comm_Dic_ICD10
(  
ID int PRIMARY KEY IDENTITY(1,1),  
Code nvarchar(20) not null,
Name nvarchar(40) not null,
PY nvarchar(40)
)
EXECUTE sp_addextendedproperty N'MS_Description', '疾病分类与代码ICD10国家临床版1.1', N'user', N'dbo', N'table', N'Comm_Dic_ICD10', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID', N'user', N'dbo', N'table', N'Comm_Dic_ICD10', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '编码', N'user', N'dbo', N'table', N'Comm_Dic_ICD10', N'column', N'Code' 
EXECUTE sp_addextendedproperty N'MS_Description', '值', N'user', N'dbo', N'table', N'Comm_Dic_ICD10', N'column', N'Name'  
EXECUTE sp_addextendedproperty N'MS_Description', '拼音码', N'user', N'dbo', N'table', N'Comm_Dic_ICD10', N'column', N'PY' 


--------ICD9字典表(Comm_Dic_ICD9CM3)
create table Comm_Dic_ICD9CM3
(  
ID int PRIMARY KEY IDENTITY(1,1),  
Code nvarchar(20) not null,
Name nvarchar(40) not null,
PY nvarchar(40),
Type nvarchar(8) not null,
kx nvarchar(4) not null
)
EXECUTE sp_addextendedproperty N'MS_Description', '手术操作分类代码ICD9CM3国家临床版1.1', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '编码', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'Code' 
EXECUTE sp_addextendedproperty N'MS_Description', '值', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'Name'  
EXECUTE sp_addextendedproperty N'MS_Description', '拼音码', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'PY' 
EXECUTE sp_addextendedproperty N'MS_Description', '类别', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'Type' 
EXECUTE sp_addextendedproperty N'MS_Description', '可选', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'kx' 

------ 患者入院、出院信息表 ------
--入院患者信息表(Inch_Patient)
Create table Inch_Patient  
(  
inpid int PRIMARY KEY IDENTITY(1,1),
Patient_ID nvarchar(30) not null,
Visit_ID smallint not null,
INP_NO nvarchar(30) not null,
Case_ID nvarchar(10) not null,
Name nvarchar(10) not null,
PY nvarchar(15),
SexCode int not null,
IdTypeID int not null,
ID_NO nvarchar(20) not null,
BirthDate date not null,
AgeYear int,
AgeMonth int,
AgeDay int,
AgeHour int,
NationCode int,
CitizenCode int,
JobCode int,
MarryCode int,
Company nvarchar(70),
PaymodeCode int,
MedicareId int,
Insur_NO nvarchar(18),
BloodCode int,
LinkMan nvarchar(10),
LinkManCode int,
RHBloodCode int,
DegreeCode int,
Link_TEL nvarchar(15),
Link_Address nvarchar(200),
HK_Address nvarchar(200),
HK_ZIP nvarchar(6),
JK nvarchar(200),
COM_TEL nvarchar(15),
COM_ZIP nvarchar(6),
DeptID int not null,
IN_DeptID int not null,
IN_DT datetime not null,
IN_Dept_DT datetime,
BedNO nvarchar(4),
NursingLevel_ID int,
Diagnosis nvarchar(10),
Allergic_Drug nvarchar(10),
PAT_ConditionID int,
IN_TypeID int,
ONE_DrName nvarchar(10),
ONE_DrID int,
Two_DrID int,
Three_DrID int,
InflagID int not null,
Dead_Date datetime,
OUT_DeptID int,
OUT_Date datetime,
OUT_TypeID int,
Money decimal(18, 2) not null,
)
EXECUTE sp_addextendedproperty N'MS_Description', '入院患者信息表', N'user', N'dbo', N'table', N'Inch_Patient', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '标识-标识自增1', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'inpid' 
EXECUTE sp_addextendedproperty N'MS_Description', '唯一标识-患者唯一标识', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Patient_ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '次数-住院次数', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Visit_ID'
EXECUTE sp_addextendedproperty N'MS_Description', '住院号-患者住院号', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'INP_NO' 
EXECUTE sp_addextendedproperty N'MS_Description', '病案号-患者病案号', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Case_ID'
EXECUTE sp_addextendedproperty N'MS_Description', '姓名-患者姓名', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '拼音码-患者姓名拼音码', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'PY'
EXECUTE sp_addextendedproperty N'MS_Description', '性别-患者性别编码，关联表His_Dic_Sex', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'SexCode' 
EXECUTE sp_addextendedproperty N'MS_Description', '证件类别-证件类别编码，关联表His_Dic_IdType', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'IdTypeID'
EXECUTE sp_addextendedproperty N'MS_Description', '证件号-患者证件号', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'ID_NO' 
EXECUTE sp_addextendedproperty N'MS_Description', '出生日期-患者出生日期', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'BirthDate'
EXECUTE sp_addextendedproperty N'MS_Description', '年龄-患者入院时年龄年', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'AgeYear' 
EXECUTE sp_addextendedproperty N'MS_Description', '年龄-患者入院时年龄月', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'AgeMonth' 
EXECUTE sp_addextendedproperty N'MS_Description', '年龄-患者入院时年龄日', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'AgeDay' 
EXECUTE sp_addextendedproperty N'MS_Description', '年龄-患者入院时年龄小时', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'AgeHour' 
EXECUTE sp_addextendedproperty N'MS_Description', '民族-患者民族编码，关联表His_Dic_Nation', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'NationCode'
EXECUTE sp_addextendedproperty N'MS_Description', '国籍-患者国籍编码，关联表His_Dic_Citizen', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'CitizenCode' 
EXECUTE sp_addextendedproperty N'MS_Description', '职业分类-患者职业分类编码，关联表His_Dic_Job', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'JobCode'
EXECUTE sp_addextendedproperty N'MS_Description', '婚姻状况-患者婚姻状况编码，关联表His_Dic_Marry', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'MarryCode' 
EXECUTE sp_addextendedproperty N'MS_Description', '工作单位-患者工作单位', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Company'
EXECUTE sp_addextendedproperty N'MS_Description', '付费方式-付费方式编码，关联表His_Dic_Paymode', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'PaymodeCode' 
EXECUTE sp_addextendedproperty N'MS_Description', '医保类型-医疗保险ID，关联表His_Dic_Medicare中的ID', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'MedicareId'
EXECUTE sp_addextendedproperty N'MS_Description', '医疗保险号-患者医疗保险号', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Insur_NO'
EXECUTE sp_addextendedproperty N'MS_Description', '血型-血型编码，关联表His_Dic_Blood', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'BloodCode' 
EXECUTE sp_addextendedproperty N'MS_Description', '联系人姓名-联系人姓名', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'LinkMan'
EXECUTE sp_addextendedproperty N'MS_Description', '联系人关系-联系人关系编码，关联表His_Dic_Link', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'LinkManCode' 
EXECUTE sp_addextendedproperty N'MS_Description', 'RH血型-RH血型编码，关联表His_Dic_RHBlood', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'RHBloodCode'
EXECUTE sp_addextendedproperty N'MS_Description', '学历-学历编码，关联表His_Dic_Degree', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'DegreeCode' 
EXECUTE sp_addextendedproperty N'MS_Description', '联系人电话-联系人电话', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Link_TEL'
EXECUTE sp_addextendedproperty N'MS_Description', '联系人地址-联系人地址', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Link_Address' 
EXECUTE sp_addextendedproperty N'MS_Description', '户口所在地-患者户口所在地', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'HK_Address'
EXECUTE sp_addextendedproperty N'MS_Description', '户口邮编-患者户口所在地邮编', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'HK_ZIP'
EXECUTE sp_addextendedproperty N'MS_Description', '籍贯-患者籍贯', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'JK' 
EXECUTE sp_addextendedproperty N'MS_Description', '单位电话-患者单位电话', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'COM_TEL'
EXECUTE sp_addextendedproperty N'MS_Description', '单位邮编-患者单位邮编', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'COM_ZIP' 
EXECUTE sp_addextendedproperty N'MS_Description', '所在科室-患者所在科室，关联表His_Dept', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'DeptID' 
EXECUTE sp_addextendedproperty N'MS_Description', '入院科室-患者入院科室，关联表His_Dept', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'IN_DeptID'
EXECUTE sp_addextendedproperty N'MS_Description', '入院时间-患者入院时间', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'IN_DT' 
EXECUTE sp_addextendedproperty N'MS_Description', '入科时间-患者入科时间', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'IN_Dept_DT'
EXECUTE sp_addextendedproperty N'MS_Description', '床号', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'BedNO'
EXECUTE sp_addextendedproperty N'MS_Description', '护理等级-关联表Comm_Dic_NursingLevel', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'NursingLevel_ID'
EXECUTE sp_addextendedproperty N'MS_Description', '过敏药物', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Allergic_Drug'
EXECUTE sp_addextendedproperty N'MS_Description', '诊断-入院主要诊断', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Diagnosis'
EXECUTE sp_addextendedproperty N'MS_Description', '病情状态-关联表Comm_Dic_Patcond', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'PAT_ConditionID' 
EXECUTE sp_addextendedproperty N'MS_Description', '入院方式，关联表His_Dic_InType', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'IN_TypeID'
EXECUTE sp_addextendedproperty N'MS_Description', '住院医师-住院医师姓名', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'ONE_DrName' 
EXECUTE sp_addextendedproperty N'MS_Description', '住院医师ID-关联表His_User', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'ONE_DrID'
EXECUTE sp_addextendedproperty N'MS_Description', '主治医师ID-关联表His_User', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Two_DrID' 
EXECUTE sp_addextendedproperty N'MS_Description', '主(副)主任医师ID-关联表His_User', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Three_DrID' 
EXECUTE sp_addextendedproperty N'MS_Description', '住院状态-关联表His_Dic_Inflag', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'InflagID' 
EXECUTE sp_addextendedproperty N'MS_Description', '死亡时间-患者死亡时间', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'Dead_Date'
EXECUTE sp_addextendedproperty N'MS_Description', '出院科室-关联表His_Dept', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'OUT_DeptID' 
EXECUTE sp_addextendedproperty N'MS_Description', '出院时间-患者出院时间', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'OUT_Date'
EXECUTE sp_addextendedproperty N'MS_Description', '出院方式-关联表His_Dic_Outpattr', N'user', N'dbo', N'table', N'Inch_Patient', N'column', N'OUT_TypeID' 

--------住院病历信息表(Inch_RecordInfo)
create table Inch_RecordInfo
(  
ID int PRIMARY KEY IDENTITY(1,1),
PatID int not null, 
VisitID int not null,
desID int not null,
Name nvarchar(50) not null,
DT datetime not null,
DeptID int not null,
CreateUserID nvarchar(10) not null,
CreateDT datetime not null,
LastUserID nvarchar(10) not null,
LastDT datetime not null
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院病历信息表', N'user', N'dbo', N'table', N'Inch_RecordInfo', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '病历ID', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '患者ID', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'PatID' 
EXECUTE sp_addextendedproperty N'MS_Description', '诊次ID', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'VisitID'
EXECUTE sp_addextendedproperty N'MS_Description', '数据集ID', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'desID' 
EXECUTE sp_addextendedproperty N'MS_Description', '病历名称', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '病历时间', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'DT' 
EXECUTE sp_addextendedproperty N'MS_Description', '病历创建时患者所在科室，用于转科后区别病历所属科室', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'DeptID' 
EXECUTE sp_addextendedproperty N'MS_Description', '创建者ID', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'CreateUserID' 
EXECUTE sp_addextendedproperty N'MS_Description', '创建时间', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'CreateDT' 
EXECUTE sp_addextendedproperty N'MS_Description', '最后修改者ID', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'LastUserID' 
EXECUTE sp_addextendedproperty N'MS_Description', '最后修改时间', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'LastDT'

--------住院病历内容表(Inch_RecordContent)
create table Inch_RecordContent
(  
rid int PRIMARY KEY, 
content image
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院病历内容表', N'user', N'dbo', N'table', N'Inch_RecordContent', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '病历ID', N'user', N'dbo', N'table', N'Inch_RecordContent', N'column', N'rid' 
EXECUTE sp_addextendedproperty N'MS_Description', '病历内容', N'user', N'dbo', N'table', N'Inch_RecordContent', N'column', N'content' 

--------住院病历编辑锁定记录表(Inch_RecordLock)
create table Inch_RecordLock
(  
RID int PRIMARY KEY, 
UserID nvarchar(10) not null,
DT datetime not null,
Machine nvarchar(50) not null
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院病历编辑锁定记录表', N'user', N'dbo', N'table', N'Inch_RecordLock', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '病历ID', N'user', N'dbo', N'table', N'Inch_RecordLock', N'column', N'RID' 
EXECUTE sp_addextendedproperty N'MS_Description', '当前编辑人ID', N'user', N'dbo', N'table', N'Inch_RecordLock', N'column', N'UserID' 
EXECUTE sp_addextendedproperty N'MS_Description', '开始编辑时间', N'user', N'dbo', N'table', N'Inch_RecordLock', N'column', N'DT' 
EXECUTE sp_addextendedproperty N'MS_Description', '编辑时使用的机器信息', N'user', N'dbo', N'table', N'Inch_RecordLock', N'column', N'Machine' 

--------住院病历内容结构表(Inch_RecordStructure)
create table Inch_RecordStructure
(  
rid int PRIMARY KEY, 
structure image
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院病历内容结构表', N'user', N'dbo', N'table', N'Inch_RecordStructure', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '病历ID', N'user', N'dbo', N'table', N'Inch_RecordStructure', N'column', N'rid' 
EXECUTE sp_addextendedproperty N'MS_Description', '病历内容结构', N'user', N'dbo', N'table', N'Inch_RecordStructure', N'column', N'structure' 

--------住院病历签名信息表(Inch_RecordSignature)
create table Inch_RecordSignature
(  
ID int PRIMARY KEY IDENTITY(1,1),
RID int not null, 
UserID nvarchar(10) not null,
DT datetime not null
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院病历签名信息表', N'user', N'dbo', N'table', N'Inch_RecordSignature', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID自增', N'user', N'dbo', N'table', N'Inch_RecordSignature', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '病历ID', N'user', N'dbo', N'table', N'Inch_RecordSignature', N'column', N'RID' 
EXECUTE sp_addextendedproperty N'MS_Description', '签名者ID', N'user', N'dbo', N'table', N'Inch_RecordSignature', N'column', N'UserID' 
EXECUTE sp_addextendedproperty N'MS_Description', '签名时间', N'user', N'dbo', N'table', N'Inch_RecordSignature', N'column', N'DT' 

--------住院会诊信息表(Inch_Consultation)
create table Inch_Consultation
(  
ID int PRIMARY KEY IDENTITY(1,1),
Apl_UserID int not null, 
Apl_DT datetime not null,
PatID int not null,
PatDeptID int not null,
Coslt_DT datetime not null,
Coslt_Place nvarchar(20),
Coslt_Abstract nvarchar(100)
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院会诊信息表', N'user', N'dbo', N'table', N'Inch_Consultation', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID自增', N'user', N'dbo', N'table', N'Inch_Consultation', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '申请人ID', N'user', N'dbo', N'table', N'Inch_Consultation', N'column', N'Apl_UserID' 
EXECUTE sp_addextendedproperty N'MS_Description', '申请时间', N'user', N'dbo', N'table', N'Inch_Consultation', N'column', N'Apl_DT' 
EXECUTE sp_addextendedproperty N'MS_Description', '患者ID', N'user', N'dbo', N'table', N'Inch_Consultation', N'column', N'PatID' 
EXECUTE sp_addextendedproperty N'MS_Description', '申请会诊时患者所在的科室ID', N'user', N'dbo', N'table', N'Inch_Consultation', N'column', N'PatDeptID' 
EXECUTE sp_addextendedproperty N'MS_Description', '会诊时间', N'user', N'dbo', N'table', N'Inch_Consultation', N'column', N'Coslt_DT' 
EXECUTE sp_addextendedproperty N'MS_Description', '会诊地点', N'user', N'dbo', N'table', N'Inch_Consultation', N'column', N'Coslt_Place' 
EXECUTE sp_addextendedproperty N'MS_Description', '会诊摘要说明', N'user', N'dbo', N'table', N'Inch_Consultation', N'column', N'Coslt_Abstract' 

--------住院会诊受邀表(Inch_ConsultationInvitee)
create table Inch_ConsultationInvitee
( 
ID int PRIMARY KEY IDENTITY(1,1),
Coslt_ID int not null,
Inv_DeptID int not null,
Inv_UserID int
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院会诊信息表', N'user', N'dbo', N'table', N'Inch_ConsultationInvitee', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '会诊信息ID，关联表Inch_Consultation的ID', N'user', N'dbo', N'table', N'Inch_ConsultationInvitee', N'column', N'Coslt_ID'
EXECUTE sp_addextendedproperty N'MS_Description', '受邀科室ID', N'user', N'dbo', N'table', N'Inch_ConsultationInvitee', N'column', N'Inv_DeptID' 
EXECUTE sp_addextendedproperty N'MS_Description', '受邀人ID', N'user', N'dbo', N'table', N'Inch_ConsultationInvitee', N'column', N'Inv_UserID' 

--------住院会诊意见表(Inch_ConsultationResult)
create table Inch_ConsultationResult
(  
ID int PRIMARY KEY IDENTITY(1,1),
Coslt_ID int not null,
DeptID nvarchar(20) not null,
UserID nvarchar(40) not null,
Result nvarchar(200) not null,
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院会诊受邀信息表', N'user', N'dbo', N'table', N'Inch_ConsultationResult', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID自增', N'user', N'dbo', N'table', N'Inch_ConsultationResult', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '住院会诊信息ID，关联表Inch_Consultation的ID', N'user', N'dbo', N'table', N'Inch_ConsultationResult', N'column', N'Coslt_ID'
EXECUTE sp_addextendedproperty N'MS_Description', '会诊意见填写人科室ID', N'user', N'dbo', N'table', N'Inch_ConsultationResult', N'column', N'DeptID'   
EXECUTE sp_addextendedproperty N'MS_Description', '会诊意见填写人ID', N'user', N'dbo', N'table', N'Inch_ConsultationResult', N'column', N'UserID'
EXECUTE sp_addextendedproperty N'MS_Description', '会诊意见', N'user', N'dbo', N'table', N'Inch_ConsultationResult', N'column', N'Result'

--------体温单字段信息
CREATE TABLE Comm_TemperField(
	id int PRIMARY KEY IDENTITY(1,1),  
	Field nvarchar(50),
	Type nvarchar(50),
	Title nvarchar(50),
	Width smallint default 50,
	Ord smallint,
	Fix bit default 0,
	Range smallint default 0
)
EXECUTE sp_addextendedproperty N'MS_Description', '体温单字段信息', N'user', N'dbo', N'table', N'Comm_TemperField', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID(自增)', N'user', N'dbo', N'table', N'Comm_TemperField', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '字段', N'user', N'dbo', N'table', N'Comm_TemperField', N'column', N'Field' 
EXECUTE sp_addextendedproperty N'MS_Description', '字段数据类型', N'user', N'dbo', N'table', N'Comm_TemperField', N'column', N'Type' 
EXECUTE sp_addextendedproperty N'MS_Description', '字段标题', N'user', N'dbo', N'table', N'Comm_TemperField', N'column', N'Title' 
EXECUTE sp_addextendedproperty N'MS_Description', '字段显示宽度', N'user', N'dbo', N'table', N'Comm_TemperField', N'column', N'Width' 
EXECUTE sp_addextendedproperty N'MS_Description', '字段显示顺序', N'user', N'dbo', N'table', N'Comm_TemperField', N'column', N'Ord' 
EXECUTE sp_addextendedproperty N'MS_Description', '是否固定列，固定列不允许编辑1：固定，0：不固定', N'user', N'dbo', N'table', N'Comm_TemperField', N'column', N'Fix' 
EXECUTE sp_addextendedproperty N'MS_Description', '应用范围，0：成人，1：新生儿', N'user', N'dbo', N'table', N'Comm_TemperField', N'column', N'Range' 

--------体温单的测温时间点所属范围
CREATE TABLE Comm_TemperRange(
	id int PRIMARY KEY IDENTITY(1,1),  
	StartDT	nvarchar(10) not null,
	EndDT nvarchar(10) not null,
	Range smallint not null
)
EXECUTE sp_addextendedproperty N'MS_Description', '体温单的测温时间点所属范围', N'user', N'dbo', N'table', N'Comm_TemperRange', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID(自增)', N'user', N'dbo', N'table', N'Comm_TemperRange', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '开始时间', N'user', N'dbo', N'table', N'Comm_TemperRange', N'column', N'StartDT' 
EXECUTE sp_addextendedproperty N'MS_Description', '结束时间', N'user', N'dbo', N'table', N'Comm_TemperRange', N'column', N'EndDT' 
EXECUTE sp_addextendedproperty N'MS_Description', '显示的测温时间点', N'user', N'dbo', N'table', N'Comm_TemperRange', N'column', N'Range' 
--------体温单的测温时间点设置数据
INSERT INTO Comm_TemperRange (StartDT, EndDT, Range) VALUES ('00:00:00', '05:59:59', 4);
INSERT INTO Comm_TemperRange (StartDT, EndDT, Range) VALUES ('06:00:00', '09:59:59', 8);
INSERT INTO Comm_TemperRange (StartDT, EndDT, Range) VALUES ('10:00:00', '13:59:59', 12);
INSERT INTO Comm_TemperRange (StartDT, EndDT, Range) VALUES ('14:00:00', '17:59:59', 16);
INSERT INTO Comm_TemperRange (StartDT, EndDT, Range) VALUES ('18:00:00', '21:59:59', 20);
INSERT INTO Comm_TemperRange (StartDT, EndDT, Range) VALUES ('22:00:00', '23:59:59', 24);

--------住院体温单数据
create table Inch_Temper_Record
(  
	id int PRIMARY KEY IDENTITY(1,1),   
	inpid int not null,
	RecDT datetime not null,
	TField nvarchar(50) not null,
	value nvarchar(50)
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院体温单数据', N'user', N'dbo', N'table', N'Inch_Temper_Record', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID(自增)', N'user', N'dbo', N'table', N'Inch_Temper_Record', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '患者唯一标识，关联表Inch_Patient的inpid', N'user', N'dbo', N'table', N'Inch_Temper_Record', N'column', N'inpid' 
EXECUTE sp_addextendedproperty N'MS_Description', '录入日期时间 格式如 2019-08-30', N'user', N'dbo', N'table', N'Inch_Temper_Record', N'column', N'RecDT'
EXECUTE sp_addextendedproperty N'MS_Description', '体温单字段，见表Comm_TemperField', N'user', N'dbo', N'table', N'Inch_Temper_Record', N'column', N'TField'
EXECUTE sp_addextendedproperty N'MS_Description', '体温单字段数值值', N'user', N'dbo', N'table', N'Inch_Temper_Record', N'column', N'value'


--新建模板存-储过程
CREATE PROCEDURE CreateTemplate(
  @TName nvarchar(20),  -- 模板名称
  @desID int,  -- 所属数据集ID
  @Owner  int,  -- 所属者
  @OwnerID int  -- 所属者ID
)
AS
BEGIN 
  --SET NOCOUNT ON;  -- 去掉返回影响行数等调试信息提高性能
  BEGIN TRAN
    declare @t_id int = 0;  
    INSERT INTO Comm_TemplateInfo (tname, desid, owner, ownerid) VALUES (@TName, @desID, @Owner, @OwnerID)
    SET @t_id = @@IDENTITY
    INSERT INTO Comm_TemplateContent (tid) VALUES (@t_id)
  COMMIT TRAN
  RETURN @t_id;
END

--删除模板存-储过程
CREATE PROCEDURE DeleteTemplate(
  @TID int  -- 模板ID
)
AS
BEGIN 
  --SET NOCOUNT ON;  -- 去掉返回影响行数等调试信息提高性能
  BEGIN TRAN
    DELETE FROM Comm_TemplateInfo WHERE id = @TID
    DELETE FROM Comm_TemplateContent WHERE tid = @TID
  COMMIT TRAN
END

--保存数据元值域对应的内容
CREATE PROCEDURE SaveDomainContent(
  @DItemID int,  -- 值域选项的ID
  @Content image  -- 值选项内容
)
AS
BEGIN 
  --SET NOCOUNT ON;  -- 去掉返回影响行数等调试信息提高性能
  BEGIN TRAN
    declare @DC_ID int = 0;  
    SET @DC_ID = (SELECT DCID FROM Comm_DomainContent WHERE DItemID = @DItemID)
    if @DC_ID > 0  -- 原来就有
	begin
	  UPDATE Comm_DomainContent SET Content = @Content WHERE DCID = @DC_ID
	end
	else  -- 原来没有
	begin
      INSERT INTO Comm_DomainContent (DItemID, Content) VALUES (@DItemID, @Content)
	end
  COMMIT TRAN
END

--新建病历-存储过程
CREATE PROCEDURE CreateInchRecord(
  @PatID nvarchar(30),  -- 患者ID
  @VisitID int,  -- 诊次
  @desID int,  -- 所属数据集ID
  @Name nvarchar(50),  -- 病历名称
  @DT datetime,  -- 病历时间
  @DeptID int,  -- 病历创建时患者所在科室，用于转科后区别病历所属科室
  @CreateUserID nvarchar(10),  -- 创建者ID
  @Content image  -- 病历内容流
)
AS
BEGIN 
  --SET NOCOUNT ON;  -- 去掉返回影响行数等调试信息提高性能
  BEGIN TRAN
    declare @rec_id int = 0;  
    INSERT INTO Inch_RecordInfo (PatID, VisitID, desID, Name, DT, DeptID, CreateUserID, CreateDT, LastUserID, LastDT) 
	  VALUES (@PatID, @VisitID, @desID, @Name, @DT, @DeptID, @CreateUserID, GETDATE(), @CreateUserID, GETDATE())
    SET @rec_id = @@IDENTITY
    INSERT INTO Inch_RecordContent (rid, content) VALUES (@rec_id, @Content)
  COMMIT TRAN
  RETURN @rec_id;
END

--修改病历-存储过程
CREATE PROCEDURE UpdateInchRecord(
  @RID int,  -- 病历ID
  @LastUserID nvarchar(10),  -- 修改者ID
  @Content image  -- 病历内容流
)
AS
BEGIN 
  --SET NOCOUNT ON;  -- 去掉返回影响行数等调试信息提高性能
  BEGIN TRAN
    UPDATE Inch_RecordInfo SET LastUserID = @LastUserID, LastDT = GETDATE() WHERE id = @RID
    UPDATE Inch_RecordContent SET content = @Content WHERE rid = @RID
  COMMIT TRAN
END

--删除病历-储过程
CREATE PROCEDURE DeleteInchRecord(
  @RID int  -- 病历ID
)
AS
BEGIN 
  --SET NOCOUNT ON;  -- 去掉返回影响行数等调试信息提高性能
  BEGIN TRAN
    DELETE FROM Inch_RecordInfo WHERE id = @RID  -- 删除病历信息
    DELETE FROM Inch_RecordContent WHERE rid = @RID  -- 删除病历内容
	DELETE FROM Inch_RecordStructure WHERE rid = @RID  -- 删除病历结构内容
	DELETE FROM Inch_RecordSignature WHERE rid = @RID  -- 删除病历签名信息
  COMMIT TRAN
END