--------创建emrDB数据库
Create Database emrDB
On primary
(
name=emrDB,
filename='C:\emrdb\emrDB.mdf',
size=3,
maxsize=unlimited,
filegrowth=1
)
Log On
(
name=mvsDB_log,
filename='C:\emrdb\emrDB_log.ldf',
size=1,
maxsize=unlimited,
filegrowth=10%
)

--------创建emrDB数据库和用户
--创建登录名和用词
Create Login emr With Password = 'admin20170613.';
--用词关联数据库
Use emrDB
Create User emr
For Login emr
With DEFAULT_SCHEMA = dbo
--访问数据库
Use emrDB
EXEC sp_addrolemember 'db_owner', 'emr'

============================框架工作所需表==========================
--------业务处理时涉及到的数据库连接
create table frame_blldbconn
(  
id int PRIMARY KEY IDENTITY(1,1),   
dbtype int not null,
conname nvarchar(20) not null,
server nvarchar(20) not null,
port int,
dbname nvarchar(20) not null,
username nvarchar(20) not null,
paw nvarchar(20) not null
)
EXECUTE sp_addextendedproperty N'MS_Description', '业务处理时涉及到的数据库连接', N'user', N'dbo', N'table', N'frame_bllDBconn', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID(自增)', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据库类型(为配合代码的枚举从0开始) 0:sqlserver, 1:oracle, 2:DB2, 3:sqlite, 4:mysql', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'dbtype' 
EXECUTE sp_addextendedproperty N'MS_Description', '连接名称', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'conname' 
EXECUTE sp_addextendedproperty N'MS_Description', '服务器地址', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'server'
EXECUTE sp_addextendedproperty N'MS_Description', '数据库端口', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'port' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据库名', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'dbname'
EXECUTE sp_addextendedproperty N'MS_Description', '账号', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'username'
EXECUTE sp_addextendedproperty N'MS_Description', '密码', N'user', N'dbo', N'table', N'frame_bllDBconn', N'column', N'paw'

--------框架业务规则表(frame_bllsql)
create table frame_bllsql
(  
id int PRIMARY KEY IDENTITY(1,1), 
bllid int not null,  
name nvarchar(20) not null,
dbconnid int not null default 0, 
sqltext nvarchar(2000) not null, 
ver nvarchar(10) not null default 0
)
EXECUTE sp_addextendedproperty N'MS_Description', '业务数据sql脚本表', N'user', N'dbo', N'table', N'frame_bllsql', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID(自增)', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '业务唯一标识ID,用户自定义的从1000开始', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'bllid' 
EXECUTE sp_addextendedproperty N'MS_Description', '业务名称', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '业务连接的数据库信息，0表示当前库否则关联表frame_blldbconn', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'dbconnid'
EXECUTE sp_addextendedproperty N'MS_Description', '执行业务对应的sql脚本', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'sqltext'
EXECUTE sp_addextendedproperty N'MS_Description', '业务对应的客户端版本(不同版本客户端调用时区分不同版本业务)', N'user', N'dbo', N'table', N'frame_bllsql', N'column', N'ver'
--------添加框架语句
INSERT INTO frame_bllsql (bllid, name, sqltext, ver) VALUES (1, '获取服务器当前时间', 'SELECT GETDATE() AS dt', '1.0');


============================自定义业务表==========================
--------系统参数及配置表(Comm_Params)
create table Comm_Params  
(  
id int PRIMARY KEY IDENTITY(1,1),
Name nvarchar(20) not null,
Value nvarchar(20),
Explain nvarchar(50),
)
EXECUTE sp_addextendedproperty N'MS_Description', '系统参数及配置表', N'user', N'dbo', N'table', N'Comm_Params', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '唯一标识(自增)', N'user', N'dbo', N'table', N'Comm_Params', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '参数名', N'user', N'dbo', N'table', N'Comm_Params', N'column', N'Name'
EXECUTE sp_addextendedproperty N'MS_Description', '参数值', N'user', N'dbo', N'table', N'Comm_Params', N'column', N'Value' 
EXECUTE sp_addextendedproperty N'MS_Description', '参数说明', N'user', N'dbo', N'table', N'Comm_Params', N'column', N'Explain' 
--------添加默认参数
INSERT INTO Comm_Params (name, value, explain) VALUES ('Hospital', '未设置当前医院', '用于系统显示的医院名称');

--------用户信息表(Comm_User)
create table Comm_User  
(  
id int PRIMARY KEY IDENTITY(1,1),
UserID nvarchar(10) not null,
UserName nvarchar(10) not null,
PY nvarchar(10),
SexID tinyint,
Birthday date,
DeptID int not null,
CreateDate date not null,
PAW nvarchar(32) not null,
State bit not null default 1
)
EXECUTE sp_addextendedproperty N'MS_Description', '用户信息表', N'user', N'dbo', N'table', N'Comm_User', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '标识-用户唯一标识', N'user', N'dbo', N'table', N'Comm_User', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '账号-用户账号', N'user', N'dbo', N'table', N'Comm_User', N'column', N'UserID' 
EXECUTE sp_addextendedproperty N'MS_Description', '姓名-用户姓名', N'user', N'dbo', N'table', N'Comm_User', N'column', N'UserName' 
EXECUTE sp_addextendedproperty N'MS_Description', '拼音简码-用户拼音简码', N'user', N'dbo', N'table', N'Comm_User', N'column', N'PY'
EXECUTE sp_addextendedproperty N'MS_Description', '性别-性别编码，关联表His_Dic_Sex', N'user', N'dbo', N'table', N'Comm_User', N'column', N'SexID' 
EXECUTE sp_addextendedproperty N'MS_Description', '生日-用户出生日期', N'user', N'dbo', N'table', N'Comm_User', N'column', N'Birthday' 
EXECUTE sp_addextendedproperty N'MS_Description', '科室-科室编码，关联表His_Dept', N'user', N'dbo', N'table', N'Comm_User', N'column', N'DeptID'
EXECUTE sp_addextendedproperty N'MS_Description', '创建日期-新建用户日期', N'user', N'dbo', N'table', N'Comm_User', N'column', N'CreateDate' 
EXECUTE sp_addextendedproperty N'MS_Description', '密码-用户密码', N'user', N'dbo', N'table', N'Comm_User', N'column', N'PAW'
EXECUTE sp_addextendedproperty N'MS_Description', '用户状态0停用1启用，默认为1', N'user', N'dbo', N'table', N'Comm_User', N'column', N'State'

--科室信息表(Comm_Dic_Dept)
create table Comm_Dic_Dept  
(  
id int PRIMARY KEY IDENTITY(1,1),   
Name nvarchar(20) not null,
PY nvarchar(20),   
ClinicattrID int,
OutpattrID int,
CreateDate date, 
State bit not null default 1 
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '科室信息表', N'user', N'dbo', N'table', N'Comm_Dic_Dept', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_Dept', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称-科室名称', N'user', N'dbo', N'table', N'Comm_Dic_Dept', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '拼音简码-科室拼音简码', N'user', N'dbo', N'table', N'Comm_Dic_Dept', N'column', N'PY'
EXECUTE sp_addextendedproperty N'MS_Description', '临床科室属性-关联表His_Dic_Clinicattr如临床科室、护理单元等', N'user', N'dbo', N'table', N'Comm_Dic_Dept', N'column', N'ClinicattrID'
EXECUTE sp_addextendedproperty N'MS_Description', '门诊住院科室属性-关联表His_Dic_Outpattr', N'user', N'dbo', N'table', N'Comm_Dic_Dept', N'column', N'OutpattrID'
EXECUTE sp_addextendedproperty N'MS_Description', '创建日期-科室创建日期', N'user', N'dbo', N'table', N'Comm_Dic_Dept', N'column', N'CreateDate'
EXECUTE sp_addextendedproperty N'MS_Description', '使用状态-(0停用 1使用)，默认为1', N'user', N'dbo', N'table', N'Comm_Dic_Dept', N'column', N'State'

--工作组(Comm_Dic_Group)
create table Comm_Dic_Group  
(  
id int PRIMARY KEY IDENTITY(1,1),   
Name nvarchar(10) not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '工作组', N'user', N'dbo', N'table', N'Comm_Dic_Group', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_Group', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称', N'user', N'dbo', N'table', N'Comm_Dic_Group', N'column', N'Name'

--工作组对应的科室(Comm_Auth_Group)
create table Comm_Auth_Group  
(  
id int PRIMARY KEY IDENTITY(1,1),   
GroupID int not null,
DeptID int not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '工作组对应的科室', N'user', N'dbo', N'table', N'Comm_Auth_Group', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Auth_Group', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '工作组ID', N'user', N'dbo', N'table', N'Comm_Auth_Group', N'column', N'GroupID'
EXECUTE sp_addextendedproperty N'MS_Description', '科室ID', N'user', N'dbo', N'table', N'Comm_Auth_Group', N'column', N'DeptID'


--角色(Comm_Dic_Role)
create table Comm_Dic_Role  
(  
id int PRIMARY KEY IDENTITY(1,1),   
Name nvarchar(10) not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '角色', N'user', N'dbo', N'table', N'Comm_Dic_Role', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_Role', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称', N'user', N'dbo', N'table', N'Comm_Dic_Role', N'column', N'Name'

--角色功能对应关系(Comm_Auth_Role)
create table Comm_Auth_Role  
(  
id int PRIMARY KEY IDENTITY(1,1),
RoleID int not null,
FunID int not null,
RangeID int not null,
RangeDept nvarchar(50)
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '角色功能对应关系', N'user', N'dbo', N'table', N'Comm_Auth_Role', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Auth_Role', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '角色ID', N'user', N'dbo', N'table', N'Comm_Auth_Role', N'column', N'RoleID'
EXECUTE sp_addextendedproperty N'MS_Description', '功能ID', N'user', N'dbo', N'table', N'Comm_Auth_Role', N'column', N'FunID'
EXECUTE sp_addextendedproperty N'MS_Description', '功能范围ID', N'user', N'dbo', N'table', N'Comm_Auth_Role', N'column', N'RangeID'
EXECUTE sp_addextendedproperty N'MS_Description', '功能范围是多科室时指定的科室（用英文逗号分隔)', N'user', N'dbo', N'table', N'Comm_Auth_Role', N'column', N'RangeDept'

--功能模块(Comm_Dic_Module)
create table Comm_Dic_Module
(  
id int PRIMARY KEY IDENTITY(1,1),
Name nvarchar(10) not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '功能模块字典表', N'user', N'dbo', N'table', N'Comm_Dic_Module', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_Module', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称', N'user', N'dbo', N'table', N'Comm_Dic_Module', N'column', N'Name'

--功能(Comm_Dic_Function)
create table Comm_Dic_Function  
(  
id int PRIMARY KEY IDENTITY(1,1),
Name nvarchar(10) not null,
ModuleID int not null,
ParentID int not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '功能', N'user', N'dbo', N'table', N'Comm_Dic_Function', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_Function', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称', N'user', N'dbo', N'table', N'Comm_Dic_Function', N'column', N'Name'
EXECUTE sp_addextendedproperty N'MS_Description', '所属模块ID，关联表Comm_Dic_Module', N'user', N'dbo', N'table', N'Comm_Dic_Function', N'column', N'ModuleID'
EXECUTE sp_addextendedproperty N'MS_Description', '父节点ID', N'user', N'dbo', N'table', N'Comm_Dic_Function', N'column', N'ParentID'

--功能范围(Comm_Dic_FunctionRange)
create table Comm_Dic_FunctionRange  
(  
id int PRIMARY KEY IDENTITY(1,1),
Name nvarchar(10) not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '功能范围', N'user', N'dbo', N'table', N'Comm_Dic_FunctionRange', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Dic_FunctionRange', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '名称', N'user', N'dbo', N'table', N'Comm_Dic_FunctionRange', N'column', N'Name'

--界面控件和功能对应关系表(Comm_Auth_UI)
create table Comm_Auth_UI  
(  
id int PRIMARY KEY IDENTITY(1,1),
FormName nvarchar(20) not null,
ControlName nvarchar(50) not null,
VisibleType int not null,
FunID int not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '界面控件和功能对应关系表', N'user', N'dbo', N'table', N'Comm_Auth_UI', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_Auth_UI', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '窗体名', N'user', N'dbo', N'table', N'Comm_Auth_UI', N'column', N'FormName'
EXECUTE sp_addextendedproperty N'MS_Description', '控件名', N'user', N'dbo', N'table', N'Comm_Auth_UI', N'column', N'ControlName'
EXECUTE sp_addextendedproperty N'MS_Description', '无权限时显示方式0不显示，1不可用', N'user', N'dbo', N'table', N'Comm_Auth_UI', N'column', N'VisibleType' 
EXECUTE sp_addextendedproperty N'MS_Description', '控件对应的功能ID', N'user', N'dbo', N'table', N'Comm_Auth_UI', N'column', N'FunID'

--用户角色(Comm_User_Role)
create table Comm_User_Role  
(  
id int PRIMARY KEY IDENTITY(1,1),
UserID nvarchar(10) not null,
RoleID int not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '用户角色', N'user', N'dbo', N'table', N'Comm_User_Role', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_User_Role', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '用户ID', N'user', N'dbo', N'table', N'Comm_User_Role', N'column', N'UserID'
EXECUTE sp_addextendedproperty N'MS_Description', '角色ID', N'user', N'dbo', N'table', N'Comm_User_Role', N'column', N'RoleID'


--用户对应的工作组(Comm_User_Group)
create table Comm_User_Group  
(  
id int PRIMARY KEY IDENTITY(1,1),
UserID nvarchar(10) not null,
GroupID int not null
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '用户对应的工作组', N'user', N'dbo', N'table', N'Comm_User_Group', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'Comm_User_Group', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '用户ID', N'user', N'dbo', N'table', N'Comm_User_Group', N'column', N'UserID'
EXECUTE sp_addextendedproperty N'MS_Description', '工作组ID', N'user', N'dbo', N'table', N'Comm_User_Group', N'column', N'GroupID'

--升级信息表(UpdateInfo)
create table UpdateInfo  
(  
id int PRIMARY KEY IDENTITY(1,1),
Version nvarchar(32) not null,
Files nvarchar(1000) not null,
Explain nvarchar(32) not null,
Enforce bit not null default 1
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '升级文件', N'user', N'dbo', N'table', N'UpdateInfo', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '版本号', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Version'
EXECUTE sp_addextendedproperty N'MS_Description', '文件', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Files'
EXECUTE sp_addextendedproperty N'MS_Description', '说明', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Explain'
EXECUTE sp_addextendedproperty N'MS_Description', '是否强制升级，1强制，0不强制', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Enforce' 

--需要客户端缓存到本地的数据表(ClientCache)
create table ClientCache  
(  
id int PRIMARY KEY IDENTITY(1,1),
tbName nvarchar(32) not null,
tbField nvarchar(32) not null,
DataVer int not null,
Used bit not null default 1
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '需要客户端缓存到本地的数据表', N'user', N'dbo', N'table', N'ClientCache', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'ClientCache', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '表名', N'user', N'dbo', N'table', N'ClientCache', N'column', N'tbName'
EXECUTE sp_addextendedproperty N'MS_Description', '字段', N'user', N'dbo', N'table', N'ClientCache', N'column', N'tbField'
EXECUTE sp_addextendedproperty N'MS_Description', '数据版本号', N'user', N'dbo', N'table', N'ClientCache', N'column', N'DataVer'
EXECUTE sp_addextendedproperty N'MS_Description', '是否在用，1在用，0废弃', N'user', N'dbo', N'table', N'ClientCache', N'column', N'Used'

--------人员信息表(Comm_User)
create table Comm_User  
(  
id int PRIMARY KEY IDENTITY(1,1),
WorkNumber nvarchar(10),
Name nvarchar(10),
PY nvarchar(10),
SexID tinyint,
Birthday date,
DeptID int,
CreateDate date,
PAW nvarchar(32),
State bit,
)
EXECUTE sp_addextendedproperty N'MS_Description', '用户信息表', N'user', N'dbo', N'table', N'Comm_User', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '唯一标识(自增)', N'user', N'dbo', N'table', N'Comm_User', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '工号-用户工号', N'user', N'dbo', N'table', N'Comm_User', N'column', N'WorkNumber'
EXECUTE sp_addextendedproperty N'MS_Description', '姓名-用户姓名', N'user', N'dbo', N'table', N'Comm_User', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '拼音简码-用户拼音简码', N'user', N'dbo', N'table', N'Comm_User', N'column', N'PY'
EXECUTE sp_addextendedproperty N'MS_Description', '性别-性别编码，关联表Comm_Dic_Sex', N'user', N'dbo', N'table', N'Comm_User', N'column', N'SexID' 
EXECUTE sp_addextendedproperty N'MS_Description', '生日-用户出生日期', N'user', N'dbo', N'table', N'Comm_User', N'column', N'Birthday'
EXECUTE sp_addextendedproperty N'MS_Description', '部门-科室编码，关联表Comm_Dept', N'user', N'dbo', N'table', N'Comm_User', N'column', N'DeptID'
EXECUTE sp_addextendedproperty N'MS_Description', '创建日期-新建用户日期', N'user', N'dbo', N'table', N'Comm_User', N'column', N'CreateDate' 
EXECUTE sp_addextendedproperty N'MS_Description', '密码-用户密码', N'user', N'dbo', N'table', N'Comm_User', N'column', N'PAW'
EXECUTE sp_addextendedproperty N'MS_Description', '用户状态0停用1启用，默认为1', N'user', N'dbo', N'table', N'Comm_User', N'column', N'State'

--------数据集目录表(Comm_DataElementSet)
create table Comm_DataElementSet
(  
id int PRIMARY KEY IDENTITY(1,1), 
pid int not null,  
Name nvarchar(20) not null,
Class int not null,
Type int not null,
UseRang smallint not null default 0,
InOrOut smallint nto null default 0,
od smallint 
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据集目录表', N'user', N'dbo', N'table', N'Comm_DataElementSet', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID(自增)', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '父节点ID', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'pid' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据集名称', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据集类别 1正文 2页眉 3页脚', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'Class' 
EXECUTE sp_addextendedproperty N'MS_Description', '类型 1数据集 2数据组', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'Type'
EXECUTE sp_addextendedproperty N'MS_Description', '使用范围 1临床 2护理 3临床及护理', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'UseRang'
EXECUTE sp_addextendedproperty N'MS_Description', '住院or门诊 1住院 2门诊 3住院及门诊', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'InOrOut'
EXECUTE sp_addextendedproperty N'MS_Description', '病历排序号', N'user', N'dbo', N'table', N'Comm_DataElementSet', N'column', N'od'

--------模板内容表(Comm_TemplateContent)
create table Comm_TemplateContent
(  
tid int PRIMARY KEY, 
content image
)
EXECUTE sp_addextendedproperty N'MS_Description', '模板内容表', N'user', N'dbo', N'table', N'Comm_TemplateContent', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '模板ID', N'user', N'dbo', N'table', N'Comm_TemplateContent', N'column', N'tid' 
EXECUTE sp_addextendedproperty N'MS_Description', '模板内容', N'user', N'dbo', N'table', N'Comm_TemplateContent', N'column', N'content' 

--------数据元值域字典表(Comm_Dic_Domain)
create table Comm_Dic_Domain
(  
DID int PRIMARY KEY IDENTITY(1,1),
DCode nvarchar(20) not null,
DName nvarchar(80)
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据元值域字典表', N'user', N'dbo', N'table', N'Comm_Dic_Domain', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'DID', N'user', N'dbo', N'table', N'Comm_Dic_Domain', N'column', N'DID' 
EXECUTE sp_addextendedproperty N'MS_Description', '值域编码', N'user', N'dbo', N'table', N'Comm_Dic_Domain', N'column', N'DCode' 
EXECUTE sp_addextendedproperty N'MS_Description', '值域名称', N'user', N'dbo', N'table', N'Comm_Dic_Domain', N'column', N'DName' 

--------数据元表(Comm_DataElement)
create table Comm_DataElement
(  
DeID int PRIMARY KEY IDENTITY(1,1),
DeCode nvarchar(16) not null,
DeName nvarchar(30) not null,
PY nvarchar(10) not null default '',
dedefine nvarchar(120) not null,
detype nvarchar(2) not null,
deformat nvarchar(10) not null default '',
frmtp nvarchar(2) not null,
deunit nvarchar(20) not null default '',
domainid int not null default 0
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据元表', N'user', N'dbo', N'table', N'Comm_DataElement', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '数据元ID', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'DeID' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据元编码', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'DeCode' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据元名称', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'DeName' 
EXECUTE sp_addextendedproperty N'MS_Description', '拼音码', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'PY'  
EXECUTE sp_addextendedproperty N'MS_Description', '定义', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'dedefine' 
EXECUTE sp_addextendedproperty N'MS_Description', '类型', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'detype' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据格式', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'deformat' 
EXECUTE sp_addextendedproperty N'MS_Description', '类别', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'frmtp' 
EXECUTE sp_addextendedproperty N'MS_Description', '单位', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'deunit' 
EXECUTE sp_addextendedproperty N'MS_Description', '值域ID', N'user', N'dbo', N'table', N'Comm_DataElement', N'column', N'domainid'

--------数据元值引用表(Comm_DataElementMacro)
create table Comm_DataElementMacro
(  
ID int PRIMARY KEY IDENTITY(1,1),  
DeID int not null,
MacroType int not null default 0,
MacroField nvarchar(200) not null default ''
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据元值引用表', N'user', N'dbo', N'table', N'Comm_DataElementMacro', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '自增ID', N'user', N'dbo', N'table', N'Comm_DataElementMacro', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据元ID', N'user', N'dbo', N'table', N'Comm_DataElementMacro', N'column', N'DeID' 
EXECUTE sp_addextendedproperty N'MS_Description', '引用类型 1:患者信息 2:用户信息 3:病历信息 4:环境信息(如当前时间等) 5:SQL脚本', N'user', N'dbo', N'table', N'Comm_DataElementMacro', N'column', N'MacroType' 
EXECUTE sp_addextendedproperty N'MS_Description', '引用字段', N'user', N'dbo', N'table', N'Comm_DataElementMacro', N'column', N'MacroField'

--------数据元值域表(Comm_DataElementDomain)
create table Comm_DataElementDomain
(  
ID int PRIMARY KEY IDENTITY(1,1),  
domainid int not null,
Code nvarchar(20) not null,
devalue nvarchar(50) not null,
PY nvarchar(10)
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据元值域表', N'user', N'dbo', N'table', N'Comm_DataElementDomain', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID', N'user', N'dbo', N'table', N'Comm_DataElementDomain', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '值域编码', N'user', N'dbo', N'table', N'Comm_DataElementDomain', N'column', N'domainid' 
EXECUTE sp_addextendedproperty N'MS_Description', '值编码', N'user', N'dbo', N'table', N'Comm_DataElementDomain', N'column', N'Code' 
EXECUTE sp_addextendedproperty N'MS_Description', '值名称', N'user', N'dbo', N'table', N'Comm_DataElementDomain', N'column', N'devalue' 
EXECUTE sp_addextendedproperty N'MS_Description', '值拼音码', N'user', N'dbo', N'table', N'Comm_DataElementDomain', N'column', N'py' 

--------数据元值域选项关联的内容表(Comm_DomainContent)
create table Comm_DomainContent
(  
DCID int PRIMARY KEY IDENTITY(1,1),
DItemID int not null, 
Content image
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据元值域选项关联的内容表', N'user', N'dbo', N'table', N'Comm_DomainContent', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '内容ID', N'user', N'dbo', N'table', N'Comm_DomainContent', N'column', N'DCID' 
EXECUTE sp_addextendedproperty N'MS_Description', '选项ID', N'user', N'dbo', N'table', N'Comm_DomainContent', N'column', N'DItemID' 
EXECUTE sp_addextendedproperty N'MS_Description', '选项内容', N'user', N'dbo', N'table', N'Comm_DomainContent', N'column', N'content' 

--------数据集包含的数据元表(Comm_DataSetElement)
create table Comm_DataSetElement
(  
ID int PRIMARY KEY IDENTITY(1,1),
DsID int not null, 
DeID int not null,
KX bit not null default 0
)
EXECUTE sp_addextendedproperty N'MS_Description', '数据集包含的数据元表', N'user', N'dbo', N'table', N'Comm_DataSetElement', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID', N'user', N'dbo', N'table', N'Comm_DataSetElement', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据集ID，对应Comm_DataElementSet中的id', N'user', N'dbo', N'table', N'Comm_DataSetElement', N'column', N'DsID' 
EXECUTE sp_addextendedproperty N'MS_Description', '数据元ID', N'user', N'dbo', N'table', N'Comm_DataSetElement', N'column', N'DeID' 
EXECUTE sp_addextendedproperty N'MS_Description', '不可缺失，必有项 1是 0否', N'user', N'dbo', N'table', N'Comm_DataSetElement', N'column', N'KX' 

--------ICD10字典表(Comm_Dic_ICD10)
create table Comm_Dic_ICD10
(  
ID int PRIMARY KEY IDENTITY(1,1),  
Code nvarchar(20) not null,
Name nvarchar(40) not null,
PY nvarchar(40)
)
EXECUTE sp_addextendedproperty N'MS_Description', '疾病分类与代码ICD10国家临床版1.1', N'user', N'dbo', N'table', N'Comm_Dic_ICD10', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID', N'user', N'dbo', N'table', N'Comm_Dic_ICD10', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '编码', N'user', N'dbo', N'table', N'Comm_Dic_ICD10', N'column', N'Code' 
EXECUTE sp_addextendedproperty N'MS_Description', '值', N'user', N'dbo', N'table', N'Comm_Dic_ICD10', N'column', N'Name'  
EXECUTE sp_addextendedproperty N'MS_Description', '拼音码', N'user', N'dbo', N'table', N'Comm_Dic_ICD10', N'column', N'PY' 

--------ICD9字典表(Comm_Dic_ICD9CM3)
create table Comm_Dic_ICD9CM3
(  
ID int PRIMARY KEY IDENTITY(1,1),  
Code nvarchar(20) not null,
Name nvarchar(40) not null,
PY nvarchar(40),
Type nvarchar(8) not null,
kx nvarchar(4) not null
)
EXECUTE sp_addextendedproperty N'MS_Description', '手术操作分类代码ICD9CM3国家临床版1.1', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '编码', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'Code' 
EXECUTE sp_addextendedproperty N'MS_Description', '值', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'Name'  
EXECUTE sp_addextendedproperty N'MS_Description', '拼音码', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'PY' 
EXECUTE sp_addextendedproperty N'MS_Description', '类别', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'Type' 
EXECUTE sp_addextendedproperty N'MS_Description', '可选', N'user', N'dbo', N'table', N'Comm_Dic_ICD9CM3', N'column', N'kx' 

--------住院病历信息表(Inch_RecordInfo)
create table Inch_RecordInfo
(  
ID int PRIMARY KEY IDENTITY(1,1),
PatID int not null, 
VisitID int not null,
desID int not null,
Name nvarchar(50) not null,
CreateUserID nvarchar(10) not null,
CreateDT datetime not null
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院病历信息表', N'user', N'dbo', N'table', N'Inch_RecordInfo', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '病历ID', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '患者ID', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'PatID' 
EXECUTE sp_addextendedproperty N'MS_Description', '诊次ID', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'VisitID'
EXECUTE sp_addextendedproperty N'MS_Description', '数据集ID', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'desID' 
EXECUTE sp_addextendedproperty N'MS_Description', '病历名称', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'Name' 
EXECUTE sp_addextendedproperty N'MS_Description', '创建者ID', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'CreateUserID' 
EXECUTE sp_addextendedproperty N'MS_Description', '创建时间', N'user', N'dbo', N'table', N'Inch_RecordInfo', N'column', N'CreateDT' 

--------住院病历内容表(Inch_RecordContent)
create table Inch_RecordContent
(  
rid int PRIMARY KEY, 
content image
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院病历内容表', N'user', N'dbo', N'table', N'Inch_RecordContent', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '病历ID', N'user', N'dbo', N'table', N'Inch_RecordContent', N'column', N'rid' 
EXECUTE sp_addextendedproperty N'MS_Description', '病历内容', N'user', N'dbo', N'table', N'Inch_RecordContent', N'column', N'content' 

--------住院病历签名信息表(Inch_RecordSignature)
create table Inch_RecordSignature
(  
ID int PRIMARY KEY IDENTITY(1,1),
RecordID int not null, 
UserID nvarchar(10) not null,
DT datetime not null
)
EXECUTE sp_addextendedproperty N'MS_Description', '住院病历签名信息表', N'user', N'dbo', N'table', N'Inch_RecordSignature', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID自增', N'user', N'dbo', N'table', N'Inch_RecordSignature', N'column', N'ID' 
EXECUTE sp_addextendedproperty N'MS_Description', '病历ID', N'user', N'dbo', N'table', N'Inch_RecordSignature', N'column', N'RecordID' 
EXECUTE sp_addextendedproperty N'MS_Description', '签名者ID', N'user', N'dbo', N'table', N'Inch_RecordSignature', N'column', N'UserID' 
EXECUTE sp_addextendedproperty N'MS_Description', '签名时间', N'user', N'dbo', N'table', N'Inch_RecordSignature', N'column', N'DT' 

--升级信息表(UpdateInfo)
create table UpdateInfo  
(  
id int PRIMARY KEY IDENTITY(1,1),
Version nvarchar(32) not null,
Files nvarchar(1000) not null,
Explain nvarchar(32) not null,
Enforce bit not null default 1
)
--为表添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '升级文件', N'user', N'dbo', N'table', N'UpdateInfo', NULL, NULL 
--为字段添加描述信息
EXECUTE sp_addextendedproperty N'MS_Description', '标识自增1', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '版本号', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Version'
EXECUTE sp_addextendedproperty N'MS_Description', '文件', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Files'
EXECUTE sp_addextendedproperty N'MS_Description', '说明', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Explain'
EXECUTE sp_addextendedproperty N'MS_Description', '是否强制升级，1强制，0不强制', N'user', N'dbo', N'table', N'UpdateInfo', N'column', N'Enforce' 

--新建模板存-储过程
CREATE PROCEDURE CreateTemplate(
  @TName nvarchar(20),  -- 模板名称
  @desID int,  -- 所属数据集ID
  @Owner  int,  -- 所属者
  @OwnerID int  -- 所属者ID
)
AS
BEGIN 
  --SET NOCOUNT ON;  -- 去掉返回影响行数等调试信息提高性能
  BEGIN TRAN
    declare @t_id int = 0;  
    INSERT INTO Comm_TemplateInfo (tname, desid, owner, ownerid) VALUES (@TName, @desID, @Owner, @OwnerID)
    SET @t_id = @@IDENTITY
    INSERT INTO Comm_TemplateContent (tid) VALUES (@t_id)
  COMMIT TRAN
  RETURN @t_id;
END

--删除模板存-储过程
CREATE PROCEDURE DeleteTemplate(
  @TID int  -- 模板ID
)
AS
BEGIN 
  --SET NOCOUNT ON;  -- 去掉返回影响行数等调试信息提高性能
  BEGIN TRAN
    DELETE FROM Comm_TemplateInfo WHERE id = @TID
    DELETE FROM Comm_TemplateContent WHERE tid = @TID
  COMMIT TRAN
END

--保存数据元值域对应的内容
CREATE PROCEDURE SaveDomainContent(
  @DItemID int,  -- 值域选项的ID
  @Content image  -- 值选项内容
)
AS
BEGIN 
  --SET NOCOUNT ON;  -- 去掉返回影响行数等调试信息提高性能
  BEGIN TRAN
    declare @DC_ID int = 0;  
    SET @DC_ID = (SELECT DCID FROM Comm_DomainContent WHERE DItemID = @DItemID)
    if @DC_ID > 0  -- 原来就有
	begin
	  UPDATE Comm_DomainContent SET Content = @Content WHERE DCID = @DC_ID
	end
	else  -- 原来没有
	begin
      INSERT INTO Comm_DomainContent (DItemID, Content) VALUES (@DItemID, @Content)
	end
  COMMIT TRAN
END

--新建病历-存储过程
CREATE PROCEDURE CreateInchRecord(
  @PatID int,  -- 患者ID
  @VisitID int,  -- 诊次
  @desID int,  -- 所属数据集ID
  @Name nvarchar(50),  -- 病历名称
  @CreateUserID nvarchar(10),  -- 创建者ID
  @Content image  -- 病历内容流
)
AS
BEGIN 
  --SET NOCOUNT ON;  -- 去掉返回影响行数等调试信息提高性能
  BEGIN TRAN
    declare @rec_id int = 0;  
    INSERT INTO Inch_RecordInfo (PatID, VisitID, desID, CreateUserID, Name, CreateDT) VALUES (@PatID, @VisitID, @desID, @CreateUserID, @Name, GETDATE())
    SET @rec_id = @@IDENTITY
    INSERT INTO Inch_RecordContent (rid, content) VALUES (@rec_id, @Content)
  COMMIT TRAN
  RETURN @rec_id;
END

--删除病历-储过程
CREATE PROCEDURE DeleteInchRecord(
  @RID int  -- 病历ID
)
AS
BEGIN 
  --SET NOCOUNT ON;  -- 去掉返回影响行数等调试信息提高性能
  BEGIN TRAN
    DELETE FROM Inch_RecordInfo WHERE id = @RID
    DELETE FROM Inch_RecordContent WHERE rid = @RID
  COMMIT TRAN
END

???????????????????????????????????????????????????????????????????????
--------框架业务窗体表(FrameWork_BllForm)
create table FrameWork_BllForm
(  
id int PRIMARY KEY IDENTITY(1,1), 
bllid int not null,  
dfm nvarchar(2000) not null,
pas nvarchar(4000) not null, 
ver nvarchar(10) not null   
)
EXECUTE sp_addextendedproperty N'MS_Description', '业务数据窗体、代码单元表', N'user', N'dbo', N'table', N'FrameWork_BllForm', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', 'ID(自增)', N'user', N'dbo', N'table', N'FrameWork_BllForm', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '业务唯一标识ID', N'user', N'dbo', N'table', N'FrameWork_BllForm', N'column', N'bllid' 
EXECUTE sp_addextendedproperty N'MS_Description', '业务名称', N'user', N'dbo', N'table', N'FrameWork_BllForm', N'column', N'dfm' 
EXECUTE sp_addextendedproperty N'MS_Description', '业务对应的sql脚本', N'user', N'dbo', N'table', N'FrameWork_BllForm', N'column', N'pas'
EXECUTE sp_addextendedproperty N'MS_Description', '业务对应的客户端版本(不同版本客户端调用时区分不同版本业务)', N'user', N'dbo', N'table', N'FrameWork_BllForm', N'column', N'ver'

--------合理用药信息表(Pass_Drug)
create table Pass_Drug  
(  
id int PRIMARY KEY IDENTITY(1,1),
mc nvarchar(50),
pym nvarchar(50),
ddim bit,
piva bit,
oldman bit,
children bit,
preg bit,
lact bit
)
EXECUTE sp_addextendedproperty N'MS_Description', '合理用药信息表', N'user', N'dbo', N'table', N'Pass_Drug ', NULL, NULL 
EXECUTE sp_addextendedproperty N'MS_Description', '唯一标识(自增)', N'user', N'dbo', N'table', N'Pass_Drug', N'column', N'id' 
EXECUTE sp_addextendedproperty N'MS_Description', '药品名称', N'user', N'dbo', N'table', N'Pass_Drug', N'column', N'mc'
EXECUTE sp_addextendedproperty N'MS_Description', '是否和其他药品有相互作用', N'user', N'dbo', N'table', N'Pass_Drug', N'column', N'ddim' 
EXECUTE sp_addextendedproperty N'MS_Description', '是否和其他药品有配伍', N'user', N'dbo', N'table', N'Pass_Drug', N'column', N'piva'
EXECUTE sp_addextendedproperty N'MS_Description', '老年人用药提醒', N'user', N'dbo', N'table', N'Pass_Drug', N'column', N'oldman' 
EXECUTE sp_addextendedproperty N'MS_Description', '儿童用药提醒', N'user', N'dbo', N'table', N'Pass_Drug', N'column', N'children'
EXECUTE sp_addextendedproperty N'MS_Description', '妊娠用药提醒', N'user', N'dbo', N'table', N'Pass_Drug', N'column', N'preg'
EXECUTE sp_addextendedproperty N'MS_Description', '哺乳用药提醒', N'user', N'dbo', N'table', N'Pass_Drug', N'column', N'lact'